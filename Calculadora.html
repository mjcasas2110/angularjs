<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <link href="../bower_components/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
    <link href="../bower_components/animate.css/animate.css" rel="stylesheet">
    <link href="site.css" rel="stylesheet" />
    <title>Calculadora</title>
</head>
<body ng-app="myCalc">
    <div class="container">
        <h2 class="site__title mega">Calculadora</h2>
        <p></p>
        <div class="panel panel-primary">
            <div class="panel-body">
                <div class="col-xs-12" ng-controller="mainCtrl">
                    <!-- Historial de operaciones -->
                    <div class="row">
                        <div class="col-xs-4">
                            <ul>
                                <li ng-repeat="operation in history">
                                    {{ operation }}
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-4">
                            <hr />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-4">
                            <strong>
                                {{ valor1 }} {{ signo }} {{ valor2 }}
                            </strong>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-4">
                            <input type="text" ng-model="resultado" class="col-xs-12 form-control text-right" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-4">
                            <hr />
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-3">
                            <button ng-repeat="number in numbers" class="col-xs-4 btn btn-default" ng-click="trabajar(number)">
                                {{ number }}
                            </button>
                        </div>
                        <div class="col-xs-1">
                            <button ng-repeat="signo in signos" class="col-xs-12 btn btn-default" ng-click="signar(signo)">
                                <strong>
                                    {{ signo }}
                                </strong>
                            </button>
                        </div>
                    </div>
                    <p></p>
                    <div class="row">
                        <div class="col-xs-3">
                            <button class="col-xs-12 btn btn-primary" ng-click="calcular()">
                                =
                            </button>
                        </div>
                        <div class="col-xs-1">
                            <button class="col-xs-12 btn btn-danger text-center" ng-click="resetear()">
                                <span class="glyphicon glyphicon-trash"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>

    <script src="../bower_components/angular/angular.js"></script>
    <script src="../bower_components/jquery/dist/jquery.js"></script>
    <script src="../bower_components/bootstrap/dist/js/bootstrap.js"></script>
    <script>
        angular.module("myCalc", [])
            .controller("mainCtrl", function ($scope) {
                $scope.numbers = '789456123C0';
                $scope.signos = '+-*/';
                $scope.history = [];

                $scope.resultado = 0;
                $scope.resultadoAnterior = 0;
                $scope.signo = '';
                $scope.valor1 = 0;
                $scope.valor2 = 0;

                $scope.trabajar = function (n) {
                    //Si n es C se resetean los valores
                    if (n === 'C') {
                        $scope.clear();
                    }
                    //Si signo no tiene valor, estoy llenando el valor1, sino estoy llenando el valor2
                    if ($scope.signo === '') {
                        //Si se guardo un resultado anterior, y no se signo la operacion, se resetean los valores.
                        if ($scope.resultado == $scope.resultadoAnterior) {
                            $scope.resultado = 0;
                            $scope.valor1 = 0;
                        }

                        var valor1 = $scope.valor1.toString();
                        valor1 += n;
                        $scope.valor1 = parseInt(valor1);
                        $scope.resultado = $scope.valor1.toString();
                    }
                    else {
                        var valor2 = $scope.valor2.toString();
                        valor2 += n;
                        $scope.valor2 = parseInt(valor2);
                        $scope.resultado = $scope.valor2;
                    }
                }

                $scope.signar = function (signo) {
                    $scope.signo = signo;
                    $scope.resultado = $scope.signo;
                }

                $scope.calcular = function () {
                    //Debe haberse seleccionado un signo para hacer el cálculo
                    if ($scope.signo != '') {
                        var valor1 = parseInt($scope.valor1);
                        var valor2 = parseInt($scope.valor2);
                        if ($scope.signo === '+') {
                            $scope.resultado = valor1 + valor2;
                        }
                        if ($scope.signo === '-') {
                            $scope.resultado = valor1 - valor2;
                        }
                        if ($scope.signo === '*') {
                            $scope.resultado = valor1 * valor2;
                        }
                        if ($scope.signo === '/') {
                            $scope.resultado = valor1 / valor2;
                        }
                        var operation = $scope.valor1 + ' ' + $scope.signo + ' ' + $scope.valor2 + ' = ' + $scope.resultado.toString()
                        $scope.history.push(operation)
                        $scope.resultadoAnterior = $scope.resultado;
                        $scope.valor1 = $scope.resultado;
                        $scope.valor2 = 0;
                        $scope.signo = '';
                    }
                }

                $scope.clear = function () {
                    $scope.signo = '';
                    $scope.valor1 = 0;
                    $scope.valor2 = 0;
                    $scope.resultado = 0;
                    $scope.resultadoAnterior = 0;
                }

                $scope.resetear = function () {
                    $scope.signo = '';
                    $scope.valor1 = 0;
                    $scope.valor2 = 0;
                    $scope.resultado = 0;
                    $scope.resultadoAnterior = 0;
                    $scope.history = [];
                }
            });
        
    </script>
    <script>
        $(document).ready(function () {
            
        })
    </script>
</body>
</html>
